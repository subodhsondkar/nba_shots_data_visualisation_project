data = [
    [
        [0, 0],
        [100, 0],
        [100, 233.0],
        [0, 279.6],
    ],
    [
        [100, 0],
        [200, 0],
        [200, 186.4],
        [100, 233.0],
    ],
    [
        [200, 0],
        [300, 0],
        [300, 139.8],
        [200, 186.4],
    ],
    [
        [300, 0],
        [400, 0],
        [400, 93.2],
        [300, 139.8],
    ],
    [
        [400, 0],
        [500, 0],
        [500, 46.6],
        [400, 93.2],
    ],
    [
        [500, 0],
        [600, 0],
        [600, 0.0],
        [500, 46.6],
    ],
    [
        [0, 279.6],
        [100, 233.0],
        [221.233, 401.376],
        [145.479, 481.652],
    ],
    [
        [100, 233.0],
        [200, 186.4],
        [296.986, 321.101],
        [221.233, 401.376],
    ],
    [
        [200, 186.4],
        [300, 139.8],
        [372.74, 240.826],
        [296.986, 321.101],
    ],
    [
        [300, 139.8],
        [400, 93.2],
        [448.493, 160.551],
        [372.74, 240.826],
    ],
    [
        [400, 93.2],
        [500, 46.6],
        [524.247, 80.275],
        [448.493, 160.551],
    ],
    [
        [500, 46.6],
        [600, 0.0],
        [600.0, 0.0],
        [524.247, 80.275],
    ],
    [
        [145.479, 481.652],
        [221.233, 401.376],
        [396.125, 512.837],
        [355.349, 615.405],
    ],
    [
        [221.233, 401.376],
        [296.986, 321.101],
        [436.9, 410.27],
        [396.125, 512.837],
    ],
    [
        [296.986, 321.101],
        [372.74, 240.826],
        [477.675, 307.703],
        [436.9, 410.27],
    ],
    [
        [372.74, 240.826],
        [448.493, 160.551],
        [518.45, 205.135],
        [477.675, 307.703],
    ],
    [
        [448.493, 160.551],
        [524.247, 80.275],
        [559.225, 102.567],
        [518.45, 205.135],
    ],
    [
        [524.247, 80.275],
        [600.0, 0.0],
        [600.0, 0.0],
        [559.225, 102.567],
    ],
    [
        [355.349, 615.405],
        [396.125, 512.837],
        [600, 551.876],
        [600, 662.252],
    ],
    [
        [396.125, 512.837],
        [436.9, 410.27],
        [600, 441.501],
        [600, 551.876],
    ],
    [
        [436.9, 410.27],
        [477.675, 307.703],
        [600, 331.126],
        [600, 441.501],
    ],
    [
        [477.675, 307.703],
        [518.45, 205.135],
        [600, 220.751],
        [600, 331.126],
    ],
    [
        [518.45, 205.135],
        [559.225, 102.567],
        [600, 110.375],
        [600, 220.751],
    ],
    [
        [559.225, 102.567],
        [600.0, 0.0],
        [600, 0.0],
        [600, 110.375],
    ],
    [
        [600, 662.252],
        [600, 551.876],
        [803.875, 512.837],
        [844.651, 615.405],
    ],
    [
        [600, 551.876],
        [600, 441.501],
        [763.1, 410.27],
        [803.875, 512.837],
    ],
    [
        [600, 441.501],
        [600, 331.126],
        [722.325, 307.703],
        [763.1, 410.27],
    ],
    [
        [600, 331.126],
        [600, 220.751],
        [681.55, 205.135],
        [722.325, 307.703],
    ],
    [
        [600, 220.751],
        [600, 110.375],
        [640.775, 102.567],
        [681.55, 205.135],
    ],
    [
        [600, 110.375],
        [600, 0.0],
        [600.0, 0.0],
        [640.775, 102.567],
    ],
    [
        [844.651, 615.405],
        [803.875, 512.837],
        [978.767, 401.376],
        [1054.521, 481.652],
    ],
    [
        [803.875, 512.837],
        [763.1, 410.27],
        [903.014, 321.101],
        [978.767, 401.376],
    ],
    [
        [763.1, 410.27],
        [722.325, 307.703],
        [827.26, 240.826],
        [903.014, 321.101],
    ],
    [
        [722.325, 307.703],
        [681.55, 205.135],
        [751.5070000000001, 160.551],
        [827.26, 240.826],
    ],
    [
        [681.55, 205.135],
        [640.775, 102.567],
        [675.753, 80.275],
        [751.5070000000001, 160.551],
    ],
    [
        [640.775, 102.567],
        [600.0, 0.0],
        [600.0, 0.0],
        [675.753, 80.275],
    ],
    [
        [1054.521, 481.652],
        [978.767, 401.376],
        [1100, 233.0],
        [1200, 279.6],
    ],
    [
        [978.767, 401.376],
        [903.014, 321.101],
        [1000, 186.4],
        [1100, 233.0],
    ],
    [
        [903.014, 321.101],
        [827.26, 240.826],
        [900, 139.8],
        [1000, 186.4],
    ],
    [
        [827.26, 240.826],
        [751.5070000000001, 160.551],
        [800, 93.2],
        [900, 139.8],
    ],
    [
        [751.5070000000001, 160.551],
        [675.753, 80.275],
        [700, 46.6],
        [800, 93.2],
    ],
    [
        [675.753, 80.275],
        [600.0, 0.0],
        [600, 0.0],
        [700, 46.6],
    ],
    [
        [1200, 279.6],
        [1100, 233.0],
        [1100, 0],
        [1200, 0],
    ],
    [
        [1100, 233.0],
        [1000, 186.4],
        [1000, 0],
        [1100, 0],
    ],
    [
        [1000, 186.4],
        [900, 139.8],
        [900, 0],
        [1000, 0],
    ],
    [
        [900, 139.8],
        [800, 93.2],
        [800, 0],
        [900, 0],
    ],
    [
        [800, 93.2],
        [700, 46.6],
        [700, 0],
        [800, 0],
    ],
    [
        [700, 46.6],
        [600, 0.0],
        [600, 0],
        [700, 0],
    ],
];

YbyX = [-0.0, -0.46445182724252493, -1.0550512573381232, -2.495057774173931, -331.126, 331.126, 2.5361879249948474, 1.0643772650932555, 0.4675585284280937, 0.0]
var ID;
missmade = []
for (var i = 0; i < 48; i++) {
    missmade.push([0, 0]);
}

$("#Reset").click(() => {
    canvas.transition().duration(750).call(zoom.transform, d3.zoomIdentity);
});
$("#PointMap").click(() => {
    abc(ID);
});
// data generated from the python file pathlinesdata.py
// {"TEAM_NAME":"Cleveland Cavaliers","PERIOD":1,"MINUTES_REMAINING":8,"SECONDS_REMAINING":56,"ACTION_TYPE":"Jump Shot","SHOT_ANGLE":0.0,"SHOT_TYPE":"2PT Field Goal","SHOT_DISTANCE":15,"SHOT_MADE_FLAG":1,"GAME_DATE":"20031029","HTM":"SAC","VTM":"CLE"}
var canvas;
var zoom;

var magicRatio = 20.4545

function abc(id) {
    console.log(id);
    d3.json("../data/" + id + "/shots_data.json", function(dataarr) {
        // console.log(dataarr)
        canvas
            .select("g")
            .selectAll("circle")
            .data(dataarr)
            .enter()
            .append("circle")
            .attr("cx", function(d) {
                var x_coor = 600;
                if (d.SHOT_ANGLE < 0) {
                    // console.log("lessthan0");
                    x_coor = 600 - ((d.SHOT_DISTANCE * magicRatio) / (Math.sqrt(1 + (d.SHOT_ANGLE * d.SHOT_ANGLE))));
                } else if (d.SHOT_ANGLE > 0) {
                    x_coor = 600 + ((d.SHOT_DISTANCE * magicRatio) / (Math.sqrt(1 + (d.SHOT_ANGLE * d.SHOT_ANGLE))));


                }
                return x_coor;
            })
            .attr("cy", function(d) {
                var y_coor = 0;
                if (d.SHOT_ANGLE != 0) {
                    y_coor = (d.SHOT_DISTANCE * magicRatio) / (Math.sqrt(1 + ((1 / d.SHOT_ANGLE) * (1 / d.SHOT_ANGLE))));
                }
                return y_coor;
            })
            .attr("r", "2")
            .attr("stroke", "black")
            .attr("stroke-width", "0.1")
            .attr("fill", "blue")
            .append("svg:title")
            .text(function(d) {
                return "Team_Name : " + d.TEAM_NAME + "\n Period : " + d.PERIOD + "\n Time Remaining : " + d.MINUTES_REMAINING + ":" + d.SECONDS_REMAINING + "\n Shot Action Type : " + d.ACTION_TYPE + "\n Shot Type : " + d.SHOT_TYPE + "\n" + ((d.SHOT_MADE_FLAG ? "SHOT MADE!!" : "SHOT MISSED!!")) + "\n" + "Game Date : " + d.GAME_DATE.substring(0, 4) + "/" + d.GAME_DATE.substring(4, 6) + "/" + d.GAME_DATE.substring(6, 8) + "\n Opponenet Team : " + d.HTM;
            });
        canvas.selectAll()
    });
}

function colour(id) {
    ID = id;
    console.log("here");
    d3.json("../data/" + id + "/shots_data.json", function(dataarr) {


        for (var i = 0; i < dataarr.length; i++) {
            for (var j = 0; j < 4; j++) {
                if (dataarr[i].SHOT_ANGLE <= YbyX[j] && dataarr[i].SHOT_ANGLE > YbyX[j + 1]) {
                    var temp = [0, 100, 200, 300, 400, 500, 600]
                    for (var k = 0; k < 6; k++) {
                        if ((dataarr[i].SHOT_DISTANCE * magicRatio) >= temp[k] && (dataarr[i].SHOT_DISTANCE * magicRatio) < temp[k + 1]) {
                            missmade[6 * j + (6 - k - 1)][dataarr[i].SHOT_MADE_FLAG]++;
                            break;
                        }
                    }
                    break;
                }
            }
            for (var j = 5; j < 9; j++) {
                if (dataarr[i].SHOT_ANGLE <= YbyX[j] && dataarr[i].SHOT_ANGLE > YbyX[j + 1]) {
                    var temp = [0, 100, 200, 300, 400, 500, 600]
                    for (var k = 0; k < 6; k++) {
                        if ((dataarr[i].SHOT_DISTANCE * magicRatio) >= temp[k] && (dataarr[i].SHOT_DISTANCE * magicRatio) < temp[k + 1]) {
                            missmade[6 * (j - 1) + (6 - k - 1)][dataarr[i].SHOT_MADE_FLAG]++;
                            break;
                        }
                    }
                    break;
                }
            }
        }
        console.log(missmade);
        console.log("Here");
        d3.select("svg").remove();

        function zoomed() {
            console.log(d3.event.transform.k)
            canvas.attr("transform", d3.event.transform);
        }

        zoom = d3.zoom().on("zoom", zoomed);
        canvas = d3
            .select("body")
            .select("#maindiv")
            .select("#svgdiv")
            .append("svg")
            .attr("width", 1200)
            .attr("height", 970)
            .attr("transform", "translate(50,50)")
            .call(zoom)
            .append("g");
        // console.log(data)
        canvas.append("path")
            .attr("d", "M150 0 L150 178 A 491 491 0 0 0 1050 178 L1050 0")
            .attr("stroke", "red")
            .attr("stroke-width", "3")
            .attr("stroke-opacity", "0.8")
            .attr("fill", "none");
        canvas.append("path")
            .attr("d", "M437 0 L437 307 L763 307 L763 0 ")
            .attr("stroke", "red")
            .attr("stroke-opacity", "0.8")
            .attr("stroke-width", "3")
            .attr("fill", "none");
        canvas.append("circle")
            .attr("cx", "600")
            .attr("cy", "307")
            .attr("r", "163")
            .attr("stroke", "red")
            .attr("stroke-opacity", "0.8")
            .attr("stroke-width", "3")
            .attr("fill", "none")
        canvas.append("path")
            .attr("d", "M89 0 L89 961 L1111 961 L1111 0 ")
            .attr("stroke", "red")
            .attr("stroke-opacity", "0.8")
            .attr("stroke-width", "3")
            .attr("fill", "none");
        console.log(canvas);
        canvas.append("g")
        canvas
            .select("g")
            .selectAll("path")
            .data(data)
            .enter()
            .append("path")
            .attr("d", function(d) {
                console.log(d);
                var path = "M";
                path += d[0][0] + " " + d[0][1] + " ";
                path += "L";
                path += d[1][0] + " " + d[1][1] + " ";
                path += "L";
                path += d[2][0] + " " + d[2][1] + " ";
                path += "L";
                path += d[3][0] + " " + d[3][1] + " ";
                path += "Z";
                console.log(path);
                return path;
            })
            .attr("stroke", "black")
            .attr("stroke-width", "1")
            .attr("fill", function(d, i) {

                console.log(missmade[i][1] / (missmade[i][0] + missmade[i][1]))
                return "rgb(" + 255 + "," + Math.floor(255 * (1 - (missmade[i][1] / (missmade[i][0] + missmade[i][1])))) + "," + 0 + ")";
            })
            .attr("fill-opacity", "0.7")
            .append("svg:title")
            .text(function(d, i) {
                return 100 * missmade[i][1] / (missmade[i][0] + missmade[i][1]);
            });
    });
}

function tomakepath() {
    console.log("Here");
    d3.select("svg").remove();

    function zoomed() {
        console.log(d3.event.transform.k)
        canvas.attr("transform", d3.event.transform);
    }

    zoom = d3.zoom().on("zoom", zoomed);
    canvas = d3
        .select("body")
        .select("#maindiv")
        .select("#svgdiv")
        .append("svg")
        .attr("width", 1200)
        .attr("height", 970)
        .attr("transform", "translate(50,50)")
        .call(zoom)
        .append("g");
    // console.log(data)
    canvas.append("path")
        .attr("d", "M150 0 L150 178 A 491 491 0 0 0 1050 178 L1050 0")
        .attr("stroke", "red")
        .attr("stroke-width", "3")
        .attr("stroke-opacity", "0.5")
        .attr("fill", "none");
    canvas.append("path")
        .attr("d", "M437 0 L437 307 L763 307 L763 0 ")
        .attr("stroke", "red")
        .attr("stroke-opacity", "0.5")
        .attr("stroke-width", "3")
        .attr("fill", "none");
    canvas.append("circle")
        .attr("cx", "600")
        .attr("cy", "307")
        .attr("r", "163")
        .attr("stroke", "red")
        .attr("stroke-opacity", "0.5")
        .attr("stroke-width", "3")
        .attr("fill", "none")
    canvas.append("path")
        .attr("d", "M89 0 L89 961 L1111 961 L1111 0 ")
        .attr("stroke", "red")
        .attr("stroke-opacity", "0.5")
        .attr("stroke-width", "3")
        .attr("fill", "none");
    console.log(canvas);
    canvas.append("g")
    canvas
        .select("g")
        .selectAll("path")
        .data(data)
        .enter()
        .append("path")
        .attr("d", function(d) {
            console.log(d);
            var path = "M";
            path += d[0][0] + " " + d[0][1] + " ";
            path += "L";
            path += d[1][0] + " " + d[1][1] + " ";
            path += "L";
            path += d[2][0] + " " + d[2][1] + " ";
            path += "L";
            path += d[3][0] + " " + d[3][1] + " ";
            path += "Z";
            console.log(path);
            return path;
        })
        .attr("stroke", "black")
        .attr("stroke-width", "1")
        .attr("fill-opacity", "0.1")
        .attr("fill", "white")
        .append("svg:title")
        .text(function(d, i) {
            return "Hey" + i;
        });


}
tomakepath();
$("#Reset").click(() => {
    canvas.transition()
        .duration(750)
        .call(zoom.transform, d3.zoomIdentity);
});